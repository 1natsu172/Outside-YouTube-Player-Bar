language: node_js
node_js:
  - "node"
cache:
  yarn: true
env:
  # Chrome WebStore ITEM_ID
  - APP_ITEM_ID=gmlbhbdkhnfhhmhdjopdbcfliajcafde
script:
  - yarn test
before_deploy:
  script:
    - env WEBSTORE_TOKEN=$(chrome-webstore-manager refresh_token --client_id $CLIENT_ID --client_secret $CLIENT_SECRET --refresh_token $REFRESH_TOKEN)
deploy:
  provider: script
  skip_cleanup: true
  script:
    yarn run build && yarn run webstore:update
  on:
    branch: master
    tags: true